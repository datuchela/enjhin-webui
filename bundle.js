(()=>{"use strict";var t;function e(t){const{elements:{bodyList:e},data:{bodies:s}}=t;e.innerHTML="",s.forEach((s=>{const o=document.createElement("li"),i=document.createElement("input"),n=document.createElement("label");o.classList.add("flex","gap-2","p-3"),i.type="radio",i.id=s.id,i.name="body",i.value=s.id,i.onchange=e=>{t.setCurrentBodyId(e.target.value),console.log(t.currentBodyId)},i.checked=t.currentBodyId===s.id,n.htmlFor=s.id,n.innerText=`Body ${s.id}`,o.appendChild(i),o.appendChild(n),e.appendChild(o)}))}function s(t){t.elements.modeButtons.forEach((e=>{e.element.disabled=!1,e.mode===t.mode&&(e.element.disabled=!0)}))}!function(t){t[t.SELECT=0]="SELECT",t[t.INSERT=1]="INSERT",t[t.MOVE=2]="MOVE",t[t.CONNECT=3]="CONNECT",t[t.DELETE=4]="DELETE"}(t||(t={}));class o{vector;constructor(t,e){this.vector=[t,e]}get x(){return this.vector[0]}get y(){return this.vector[1]}set x(t){this.vector[0]=t}set y(t){this.vector[1]=t}get length(){return Math.sqrt(this.x**2+this.y**2)}set length(t){throw new Error(`Tried to set ${t} as vector length, you cannot set vector length explicitly.`)}get unit(){return 0===this.length?new o(0,0):new o(this.x/this.length,this.y/this.length)}set unit(t){throw new Error(`Tried to set ${t} as a unit vector, you cannot set unit vector explicitly.`)}clone=()=>new o(this.x,this.y);static isEqual=(t,e)=>t.x===e.x&&t.y===e.y;static crossProduct=(t,e)=>t.x*e.y-t.y*e.x;static dotProduct=(t,e)=>t.x*e.x+t.y*e.y;static add=(t,e)=>new o(t.x+e.x,t.y+e.y);static subtract=(t,e)=>new o(t.x-e.x,t.y-e.y);static scale=(t,e)=>new o(t.x*e,t.y*e);draw=(t,e,s,o)=>{t.strokeStyle=o?.color??"red",t.beginPath(),t.moveTo(e,s),t.lineTo(e+this.x,s+this.y),t.stroke()}}const i={softBodyId:0,particleId:0,springId:0};class n{id;particles;springs;constructor(t,e){this.id=""+ ++i.softBodyId,this.particles=t??[],this.springs=e??[]}}class r{id;position;springIds;bodyIds;constructor(t){this.id=""+ ++i.particleId,this.position=t,this.springIds=[],this.bodyIds=[]}}class d{id;particles;bodyIds;constructor(t){this.id=""+ ++i.springId,this.particles=t,this.bodyIds=[]}}function a(t,e){let s=Number.MAX_SAFE_INTEGER,i=null;return e.forEach((e=>{const n=o.subtract(t,e.position).length;n<s&&(i=e,s=n)})),{particle:i,distance:s}}class c{element;ctx;_mouseCoords=new o(16,780);_mouseCoordsColor="white";constructor(t){this.element=t;const e=t.getContext("2d");if(null===e)throw new Error("Unable to get 2d context from canvas");this.ctx=e}redraw=(e,s)=>{this.clearBackground("black"),this.drawSprings(e.data.springs),e.mode===t.CONNECT&&e.mouse.isMouseDown&&e.mouse.savedParticle&&l(e.ctx,e.mouse.savedParticle.position,e.mouse.position,"white",1),this.drawParticles(e.data.particles,e.mouse.closestParticle),this.drawCoordinates(e.mouse.position,this._mouseCoords,this._mouseCoordsColor)};clearBackground=t=>{!function(t,e){t.save(),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()}(this.ctx,t)};drawParticles=(t,e)=>{t.forEach((t=>{var s,o;e&&e.id===t.id&&(s=this.ctx,o=t.position,s.save(),s.strokeStyle="white",s.lineWidth=2,s.beginPath(),s.arc(o.x,o.y,8,0,2*Math.PI),s.stroke(),s.restore()),function(t,e){t.save(),t.fillStyle="#FCE93D",t.strokeStyle="blue",t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.fill(),t.restore()}(this.ctx,t.position)}))};drawSprings=t=>{t.forEach((t=>{l(this.ctx,t.particles[0].position,t.particles[1].position,"#FFFFFF",2)}))};drawCoordinates(t,e,s){this.ctx.save(),this.ctx.fillStyle=s,this.ctx.fillText(`x: ${t.x}  y: ${t.y}`,e.x,e.y),this.ctx.restore()}}function l(t,e,s,o,i){t.save(),t.strokeStyle=o,t.lineWidth=i??1,t.moveTo(e.x,e.y),t.lineTo(s.x,s.y),t.stroke(),t.restore()}class u{canvas;canvasElement;ctx;elements;data;mode;currentBodyId;mouse;constructor(e,s){this.canvas=new c(e),this.canvasElement=this.canvas.element,this.ctx=this.canvas.ctx,this.elements=s.elements,this.data=s.data??{bodies:[],springs:[],particles:[]},this.mouse={position:new o(0,0),isMouseDown:!1,closestParticle:null,savedParticle:null},this.mode=t.INSERT,this.currentBodyId=null}getBodyById=t=>{const e=this.data.bodies.find((e=>e.id===t));if(!e)throw new Error(`Couldn't find body with id ${t}`);return e};getParticleById=t=>{const e=this.data.particles.find((e=>e.id===t));if(!e)throw new Error(`Couldn't find particle with id ${t}`);return e};getSpringById=t=>{const e=this.data.springs.find((e=>e.id===t));if(!e)throw new Error(`Couldn't find spring with id ${t}`);return e};addBody=t=>{this.data.bodies.push(t)};addSpring=(t,e)=>{const s=this.getBodyById(e);t.bodyIds.push(e),this.data.springs.push(t),s.springs.push(t.id)};addParticle=(t,e)=>{const s=this.getBodyById(e);t.bodyIds.push(e),this.data.particles.push(t),s.particles.push(t.id)};connectParticles=t=>{const e=new d(t);return t.forEach((t=>t.springIds.push(e.id))),e};setCurrentBodyId=t=>{this.currentBodyId=t};setMode=t=>{this.mode=t};updateClosestParticle=()=>{const{particle:t,distance:e}=a(this.mouse.position,this.data.particles);this.mouse.closestParticle=!t||e>8?null:t};removeParticleById=t=>{const e=this.getParticleById(t);e.bodyIds.forEach((e=>{const s=this.getBodyById(e);s.particles=s.particles.filter((e=>e!==t))})),e.springIds.forEach((t=>this.removeSpringById(t))),this.data.particles=this.data.particles.filter((e=>e.id!==t))};removeSpringById=t=>{const e=this.getSpringById(t);e.bodyIds.forEach((e=>{const s=this.getBodyById(e);s.springs=s.springs.filter((e=>e!==t))})),e.particles.forEach((e=>e.springIds=e.springIds.filter((e=>e!==t)))),this.data.springs=this.data.springs.filter((e=>e.id!==t))};removeBodyById=t=>{const e=this.getBodyById(t);e.particles.forEach((t=>{this.removeParticleById(t)})),e.springs.forEach((t=>{console.log("removingSprings from bodyRemove"),this.removeSpringById(t)})),this.data.bodies=this.data.bodies.filter((e=>e.id!==t))}}var h;(()=>{const o=document.getElementById("enjhin-editor"),i=document.getElementById("list-view"),d=document.getElementById("mode-select"),c=document.getElementById("mode-insert"),l=document.getElementById("mode-move"),m=document.getElementById("mode-connect"),y=document.getElementById("mode-delete"),p=document.getElementById("export"),E=document.getElementById("new-body"),g=document.getElementById("delete-body");if(!o)throw new Error("Couldn't get canvas");if(!i)throw new Error("Couldn't get bodyList");if(!d)throw new Error("Couldn't get selectModeBtn");if(!c)throw new Error("Couldn't get insertModeBtn");if(!l)throw new Error("Couldn't get moveModeBtn");if(!m)throw new Error("Couldn't get connectModeBtn");if(!y)throw new Error("Couldn't get deleteModeBtn");if(!p)throw new Error("Couldn't get exportBtn");if(!E)throw new Error("Couldn't get newBodyBtn");if(!g)throw new Error("Couldn't get deleteBodyBtn");o.width=1366,o.height=800,h=new u(o,{elements:{exportButton:p,newBodyButton:E,bodyList:i,modeButtons:[{mode:t.SELECT,element:d},{mode:t.INSERT,element:c},{mode:t.MOVE,element:l},{mode:t.CONNECT,element:m},{mode:t.DELETE,element:y}]}}),p.addEventListener("click",(t=>function(t,e){const s={particles:e.data.particles.map((t=>{const{bodyIds:e,springIds:s,...o}=t;return o})),springs:e.data.springs.map((t=>{const{bodyIds:e,...s}=t;return s}))};console.log(JSON.stringify(s))}(0,h))),E.addEventListener("click",(()=>function(t){const s=new n;t.addBody(s),t.setCurrentBodyId(s.id),e(t)}(h))),g.addEventListener("click",(()=>function(t){t.currentBodyId&&(t.removeBodyById(t.currentBodyId),t.data.bodies.length>0?t.setCurrentBodyId(t.data.bodies[t.data.bodies.length-1].id):t.setCurrentBodyId(null),e(t))}(h))),h.canvasElement.addEventListener("mousedown",(e=>function(e,s){switch(s.mouse.isMouseDown=!0,s.updateClosestParticle(),s.mode){case t.SELECT:break;case t.INSERT:if(null===s.currentBodyId)break;const e=new r(s.mouse.position.clone());s.addParticle(e,s.currentBodyId);break;case t.MOVE:break;case t.CONNECT:const{particle:o,distance:i}=a(s.mouse.position,s.data.particles);if(!o||i>8)break;s.mouse.savedParticle=o;break;case t.DELETE:if(!s.mouse.closestParticle)break;s.removeParticleById(s.mouse.closestParticle.id)}}(0,h))),h.canvasElement.addEventListener("mousemove",(e=>function(e,s){const o=s.canvasElement.getBoundingClientRect();switch(s.mouse.position.x=e.clientX-o.left,s.mouse.position.y=e.clientY-o.top,s.updateClosestParticle(),s.mode){case t.SELECT:case t.INSERT:break;case t.MOVE:if(!s.mouse.isMouseDown||!s.mouse.closestParticle)break;i=s.mouse.position,s.mouse.closestParticle.position=i.clone();case t.CONNECT:}var i}(e,h))),h.canvasElement.addEventListener("mouseup",(e=>function(e,s){switch(s.mouse.isMouseDown=!1,s.mode){case t.CONNECT:const{particle:e,distance:o}=a(s.mouse.position,s.data.particles);if(!s.currentBodyId||!e||o>8||!s.mouse.savedParticle||s.mouse.savedParticle.id===e.id)break;const i=s.connectParticles([s.mouse.savedParticle,e]);s.addSpring(i,s.currentBodyId);break;default:s.mouse.closestParticle=null,s.mouse.savedParticle=null}}(0,h))),h.elements.modeButtons.forEach((t=>{t.element.addEventListener("click",(()=>function(t,e){e.setMode(t),s(e)}(t.mode,h)))})),function(t){s(t)}(h),requestAnimationFrame((function t(e){h.canvas.redraw(h),requestAnimationFrame(t)}))})()})();
//# sourceMappingURL=bundle.js.map